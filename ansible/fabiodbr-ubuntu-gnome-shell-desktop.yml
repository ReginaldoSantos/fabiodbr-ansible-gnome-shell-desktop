---
- hosts: localhost

  become: true

  vars:
    usuario: "{{ lookup('env','USER') }}"

  tasks:

  - name: Docker apt-key
    apt_key: 
      url: https://download.docker.com/linux/ubuntu/gpg
      state: present

  - name: Add PPAs
    apt_repository:
      repo: '{{ item }}'
    with_items:
      - ppa:gnome-terminator/nightly-gtk3
      - ppa:noobslab/themes
      - ppa:noobslab/icons
      - ppa:gencfsm
      - ppa:videolan/stable-daily
      - ppa:otto-kesselgulasch/gimp-edge
#      - ppa:noobslab/macbuntu
    ignore_errors: yes

  - name: Upgrade packages
    apt:
      upgrade: yes
      dpkg_options: 'force-confold,force-confdef'
      autoremove: yes
      update_cache: yes
    ignore_errors: yes

  - name: Install Packages
    apt:
      name: "{{ item }}"
      state: latest
    with_items:
      - fonts-powerline
      - fonts-fantasque-sans
      - python-pip
      - vim
      - git
      - gnome-tweak-tool
      - chrome-gnome-shell
      - arc-theme
      - arc-icons
      - gnome-shell-extensions
      - lm-sensors
      - gnome-shell-extension-weather
      - terminator
      - gnome-encfs-manager
      - curl
      - apt-transport-https
      - ca-certificates
      - software-properties-common
      - vlc
      - ubuntu-make
      - gimp
      - network-manager-openvpn-gnome
#      - macbuntu-os-ithemes-v10
#      - macbuntu-os-icons-v10
      - deluge

  - name: powerline-shell pip
    state: latest
    pip:
      name: powerline-shell

  - name: Sudoers
    lineinfile:
       path: /etc/sudoers
       line: "{{ usuario }} ALL=(ALL) NOPASSWD:ALL"
       insertafter: EOF
       validate: '/usr/sbin/visudo -cf %s'

  - name: Terminator Nord theme
    git:
      repo: https://github.com/arcticicestudio/nord-terminator.git
      dest: /tmp/nord
  - file:
      path: '/home/{{ usuario }}/.config/terminator'
      state: directory
      owner: '{{ usuario }}'
      group: '{{ usuario }}'
      mode: 0755
  - copy:
      src: '/tmp/nord/src/config'
      dest: '/home/{{ usuario }}/.config/terminator/config'
      owner: "{{ usuario }}"
      group: "{{ usuario }}"
      mode: 0644
  - replace:
      dest: '/home/{{ usuario }}/.config/terminator/config'
      regexp: 'nord'
      replace: 'default'
  - lineinfile:
      dest: '/home/{{ usuario }}/.config/terminator/config'
      regexp: '^background_color'
      insertafter: '^background_color'
      line: "    {{ item.property }} = {{ item.value }}"
    with_items: 
      - { property: 'background_darkness', value: '0.9' }
      - { property: 'background_type', value: 'transparent' } 
      - { property: 'scrollback_lines', value: '50000' } 
      - { property: 'font', value: 'Liberation Mono 8' } 
      - { property: 'use_system_font', value: 'False' } 

  - name: Configura powerline-shell
    blockinfile:
      path: /etc/bash.bashrc
      insertafter: EOF
      content: |
        function _update_ps1() {
          PS1=$(powerline-shell $?)
        }
        if [[ $TERM != linux && ! $PROMPT_COMMAND =~ _update_ps1 ]]; then
           PROMPT_COMMAND="_update_ps1; $PROMPT_COMMAND"
        fi

  - name: Git gnome-shell-extension-freon
    become_user: "{{ usuario }}"
    git:
      repo: https://github.com/UshakovVasilii/gnome-shell-extension-freon.git
      version: master
      update: yes
      force: yes
      dest: '/tmp/freon'
  - name: Copy Freon
    become_user: "{{ usuario }}"
    copy:
      src: "/tmp/freon/freon@UshakovVasilii_Github.yahoo.com"
      dest: "/home/{{ usuario }}/.local/share/gnome-shell/extensions"
      owner: "{{ usuario }}"
      force: yes

  - name: Git easyscreencast
    become_user: "{{ usuario }}"
    git:
      repo: https://github.com/EasyScreenCast/EasyScreenCast.git
      version: master
      update: yes
      force: yes
      dest: '/tmp/easyscreencast'
  - name: Install & enable easyscreencast
    become_user: "{{ usuario }}"
    shell: |
      cd /tmp/easyscreencast
      make
      make install
      gnome-shell-extension-tool -e EasyScreenCast@iacopodeenosee.gmail.com
      exit 0
  

